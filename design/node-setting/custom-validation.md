# 自定义验证

> 在更改设置时，可以配合使用[实时预览](../preview/realtime.md)和[完整预览](../preview/full.md)来查看效果。

## 先说说基本验证
在收集答案的过程中，我们希望受访者能够输入有效的答案，而不是胡乱作答，成千上万的答题胡乱作答的后果是我们会收集到一堆毫无意义的垃圾数据。
所以一般情况下各种题目都会有一些内置的验证方式来防止胡乱作答的情况，大概包含以下几种情况：
+ 必答题：必须输入一些答案，不能直接跳过。[参考](./common.md#必答题)
+ 单选题：永远只能一项。
+ 多选题：只能选中指定数量范围内的选项数目。[参考](./common.md#多选题)
+ 设置过排他的选项，互相排斥的两个选项不能同时被选中。[参考](./option-exclude.md)
+ 对于打分题，填空题，可以限制最小输入项限制。[参考](./common.md#最小输入项限制)
+ 对于填空题和其他选项的备注栏，可以验证输入内容。[参考](./input-validation.md)

但是对于一份复杂的问卷来说，可能还有多验证规则是基于问卷逻辑本身的，而这些验证实现无法预知的，没法包含在内置规则之中，所以在这些基本验证的基础上，可以添加自定义的验证规则。

## 使用自定义验证
自定义验证在节点编辑栏的第二个Tab中，可以看到其中包含`接口请求验证`和`内置逻辑验证`两个开关，以及一个`禁用错误信息`的开关。


### 接口请求验证

> 前提：该功能要求问卷设置者拥有编程能力，或者寻找程序员小伙伴帮忙。

对于基本验证的无法完成的任务，可通过接口请求验证来完整验证，顾名思义就是通过请求一个配置好的接口，通过检查接口返回的结果来决定验证有没有通过，请求接口时可以携带参数,如果没有通过验证，接口返回的内容中还可以携带未通过的原因，用户答题时可以看到改原因。

接口请求验证可以完成任意规则的验证，适用于超级复杂的规则。

具体的工作方式参照[接口请求](../advance-topic/request.md)

### 内置逻辑验证
虽然接口验证很强大，但是要在外部开发一个接口，比较麻烦。
如果验证规则虽然通过基本在验证无法达到，但是也不是太复杂，则可以通过内置逻辑验证来实现，编辑器中内置了一条简单的逻辑运算功能，通过检查逻辑运算的结果，可以确定验证是否通过，如果不通过还可以填写不通过的理由，让受访者看到。

关于内置逻辑运算的规则，参照[内置逻辑编辑器](../logic/logic-editor.md)

具体的内置逻辑运算工作方式参照[逻辑验证](../logic/validation.md)


### 禁用错误信息
自定义验证在点击下一题时才会触发，如果验证没有通过则默认会显示未通过的理由（由接口或逻辑验证设置中提供），但是也可以掩盖这个错误消息，即使受访者回答错误，也不阻止他们继续往下一题，这种情况下，这道题目会被标记为`自定义验证失败`的状态（参照[隐式变量](../variable/implicit.md)），后续可以根据该状态进行其他操作.

> 一般来说，显示信息是为了让受访者纠正不符合要求胡乱填写的答案，这是明着来的，试着纠正一下正常范围内常规逻辑上的错误，同时不建议矫枉过正，这样容易失去调查的意义。

> 而掩盖错误消息，则是暗地里操作，受访者不知不觉就进入了陷阱，后续一般可以判断受访者有没有进入陷阱而提前终止他们答题，这种情况比较适用于那些带有奖励的问卷中去防范投机乱填答案刷奖励的受访者，但是又不让他们轻易明白为什么自己拿不到奖励。