# 循环节点

> 节点和题目的通用的设置在[节点设置](../node-setting/concept.md)中有讲解，此处只讲解该节点或题目特有的功能。

> 在更改设置时，可以配合使用[实时预览](../preview/realtime.md)和[完整预览](../preview/full.md)来查看效果。

循环节点用来控制在不同的条件下重复做一些题目，达到减少题目数量，简化问卷的目的。

<img src='./images/loop.png' width='1000'>

## 案列
考虑这样的情形：我要为通用汽车做一份对于汽车品牌的调查，我希望调查用户对通用汽车旗下的`雪佛兰`，`凯迪拉克`两个品牌的`外观`，`功能`，`舒适度`三个方面的印象，为了能够达到横向对比效果，我还会提供一大堆其他厂家的汽车品牌混入进来，对他们也询问这三个方面的印象，这些混入的品牌会非常多，我们不能对所有的品牌都问一遍，这样题目会变得非常多，答题者可能会没有足够的耐心答完这些题目，所以我们事会让答题者从大量的品牌中选择几个自己喜欢的品牌当成混入的品牌。

按照上面的情形，其实我们最核心的题目就是训完三方面印象的这道题，只是他要被询问多次，除了`雪佛兰`，`凯迪拉克`两次是确定的，其他的若干次的品牌和次数都是不确定的。

我们来看看用常规功能怎么设计一份这样的问卷：

假设所有的条件和次数都是确定的，如：我们只调查`雪佛兰`，`别克`,`凯迪拉克`,`大众`,`奥迪`这几个品牌，则我们重复添加五个结构相同的题目对三方面进行询问即可（问题文字会针对不同品牌而各不相同，但其他都是一样的），但是如果品牌数变成20个或更多，则需要复制20个题目，这样就不妙了。

假设所有条件和次数都是不确定的，如上面最开始考虑的情形，要询问的品牌和次数都源自于答题者在上一题中的选择结果。这时候用常规方法是无法做到的。

使用循环节点不仅能够做到上面的功能，而且轻松搞定。

## 了解功能

在画布中，循环节点出了输入口和输出外，底部还有一个循环开始和循环结束口，循环开始时一个输出口，可以输出到另一个节点，循环结束是一个输入口，可以接受其他节点的输出，用法是从循环开始输出到一些题目，这些题目最后又会输入到循环结束，这些在循环开始和循环结束之前的节点被称为`循环圈节点`。

循环节点身上可以设置[循环变量](../variable/loop-type.md)，在循环节点的右侧编辑栏中可以看到包含`自身循环变量`和`外部循环变量`两种，前者是在循环节点身上设定好的，是固定的，后者是从之前的题目中引用过来的，是动态的。

> 其实自身循环变量与外部循环变量的关系，同题目中的选项与[引用选项](../opt-reference/concept.md)的关系是一样的。

当答题的时候碰到循环节点，就会把循环节点的`自身循环变量`和`外部循环变量`（这时候已经由动态计算得出了固定结果）都取出来得到多个变量，拿出第一个，对`循环圈节点`中的所有题目询问一遍，当问完后，又会拿出第二个，再对`循环圈节点`中的所有题目询问一遍，如此重复，直到所有变量都用完了才会从循环节点的输出口去问后续的题目，通过这个功能可以避免重复造题的不妙处境。

`循环圈节点`中的所有节点，都能使用[循环变量](../variable/loop-type.md)，代表每次重复对`循环圈节点`发问时，当前使用的变量，这样就能达到虽然每次都是使用的同样的`循环圈节点`，但是每次被问时，被展示的内容却不相同。

> 上图中第二个右侧编辑栏中，`R3`的问题文字中展示了循环变量的使用方法。如何使用变量？请参照[变量使用](../variable/usage.md)

## 结合案列
上图的问卷片段中，第一道选择题M1从海量的其他品牌（简单起见，案列中只用了四个）中让用户选择一些自己感兴趣的作为后续混入的品牌；在循环节点LOOP_3中，自身循环变量设置了`雪佛兰`，`凯迪拉克`两项，外部循环变量使用了`M1/已选中的选项/选项文字`(这是[选项引用](../opt-reference/concept.md)规则，正是这一操作将之前答题者感兴趣的品牌混入了进来)，LOOP_3的循环圈节点只包含一个R3，R3的问题文字是中引用了循环变量。

如果答题者在M3中选择了感兴趣的品牌是`奥迪`和`大众`，则循环圈节点分别会被询问四次，分别是：
1. 请你对`雪佛兰`的以下方面进行评分。
2. 请你对`凯迪拉克`的以下方面进行评分。
3. 请你对`奥迪`的以下方面进行评分。
4. 请你对`大众`的以下方面进行评分。

## 变量循序随机
循环变量使用的顺序可被打乱，其打乱规则同[选项随机](../node-setting/option-random.md)