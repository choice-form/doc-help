# 构建规则

1. 扫描文档顶层目录，得到支持的语言列表，生成一个总数据中包含了这些语言，但是资源url暂时为空
```typescript
// main.json
{
  'zh-cn': {
    indexUrl: '',
    searchUrl: '',
  },
  'en-us': {
    indexUrl: '',
    searchUrl: '',
  },
}
```
2. 扫描各个语言的文档目录，区分markdown文件和其他文件，要忽略某些系统生成的文件如.DS_Store之流。
  + 生成一个空的目录概览数据。
  + 生成一个空的搜索概要数据
2. 对于非markdown文件，全部读取内容并生成hash，生成一个hash值对照表。
3. 将非markdown文件移动到dist目录里对应结构的文件夹中，同时文件名中会会被附加自己的hash值。
4. 对于markdown文件，逐层逐个进行转化，直到所有文件转化完成。

  + 对文件夹读取.index文件获得序号和展示名，将信息加入到目录概览数据中携带序号。
  + 读取子资源文件链接替换为cdn绝对路径并携带hash值，根据之前的hash值对照表。
  + 读取头部的index,tag,summary配置，获得序号和搜索概要内容。
  + 移除头部配置后转化markdown为html，将概要内容和html写入到dist中对应文件夹中，同时文件名中携带自己的内容hash。
  + 将该文件的转化内容写入到目录概览数据中，携带序号。将该文件的搜索概要内容加入到搜索概要数据中。
  + 继续下一个文件或文件或文件夹重复以上操作，直到所有文件或文件夹都被用完。
5. 完成转化数据后目录概要数据和所有概要数据都应该被填充完成了，然后对目录概要数据进行排序，排序完成后删除其中的序号属性。

6. 将目录概要数据和搜索概要数据写成文件放到dist目录下，文件名中都会附加自己的内容hash，同时将地址记录到总数据中。

7. 将总数据写成文件放到dist目录下，完成构建。